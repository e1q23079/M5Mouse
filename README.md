# M5ジャイロマウス

M5Stick-Cの内蔵IMUセンサー（加速度計とジャイロスコープ）を使用して、デバイスの傾きや回転を検出し、BLE（Bluetooth Low Energy）でパソコンやタブレットにマウスコマンドを送信するプログラムです。

## 機能

- **ジャイロマウス機能**: デバイスを傾けることで、マウスカーソルを操作
- **スクロール機能**: ボタンA/Bでホイールスクロール
- **マウスモード切り替え**: 電源ボタンでマウス機能のON/OFF
- **BLE接続表示**: ディスプレイに接続状態を表示

## 必要な環境

- **ハードウェア**:
  - M5Stick-C（IMUセンサー搭載）
  - Bluetooth対応のPC/タブレット

- **ソフトウェア**:
  - PlatformIO
  - 必要なライブラリ（自動でインストール）:
    - M5Unified
    - ESP32 BLE Mouse
    - Madgwick AHRS

## 使い方

### 1. ビルドと書き込み

```bash
# ビルド
platformio run

# デバイスに書き込み
platformio run --target upload
```

### 2. Bluetoothペアリング

1. デバイスの電源を入れます
2. PCまたはタブレットのBluetooth設定を開きます
3. 「M5Mouse」を探してペアリングします
4. ディスプレイに「Connected」と表示されたら成功です

### 3. デバイスの向き

M5Stick-Cは以下の向きで使用してください：

- **ボタン側（Type-Cの充電ポート）を手前（前）に向ける**
- ディスプレイが自分に向いている状態
- この向きを基準に、左右の方向に向けるとカーソルが左右に動き、上下の方向に向けるとカーソルが上下に動きます

正しい向きで使用しないと、マウスの動きが期待と異なるため、必ずこの向きで操作してください。

### 4. 操作方法

| 操作 | 機能 |
| ------ | ------ |
| デバイスを傾ける | マウスカーソルを移動 |
| ボタンA（上） | ホイールスクロール上 |
| ボタンB（下） | ホイールスクロール下 |
| 電源ボタン | マウスモードのON/OFF |

### 5. マウス移動の感度

マウスの移動量は`main.cpp`で以下のパラメータで調整できます：

```cpp
int x = -1 * (yaw - preYaw) * 5;   // 左右の感度（5を調整）
int y = (roll - preRoll) * 3;      // 上下の感度（3を調整）
```

数値を大きくするとより敏感に、小さくするとゆっくり動きます。

## トラブルシューティング

### Bluetoothが接続できない場合

- デバイスを再起動してください
- PCのBluetoothを一度OFF/ONにしてください
- ペアリング情報をリセットして再度ペアリングしてください

### マウスが動きすぎる/動きが少ない場合

- `main.cpp`の感度パラメータを調整してください

### デバイスのディスプレイに何も表示されない場合

- コードが正しく書き込まれているか確認してください
- 別のビルド設定を試してください

## 技術仕様

- **センサー**: 6軸IMU（加速度計 + ジャイロスコープ）
- **センサーフュージョン**: Madgwickアルゴリズム
- **サンプリング周波数**: 100Hz
- **通信方式**: Bluetooth Low Energy（BLE）
